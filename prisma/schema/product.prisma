// ─── Product Catalog ──────────────────────────────────────

model Product {
  id           String        @id @default(cuid())
  name         String
  slug         String        @unique
  brand        String?
  description  String?       @db.Text
  // Eyewear-specific
  frameShape   FrameShape?
  material     Material?
  faceShape    String[]      // tròn, dài, vuông, trái tim
  style        String[]      // basic, sang, chơi, biz, retro
  gender       Gender?
  lensWidth    Int?
  bridge       Int?
  templeLength Int?
  lensHeight   Int?          // mm
  frameWidth   Int?          // mm
  frameType    String?       // full-rim / half-rim / rimless
  fit          String?       // narrow / medium / wide
  pdRange      String?       // e.g. "58-68"
  weight       Int?          // grams
  uvProtection   String?     // UV400 etc
  blueLightBlock Boolean?    @default(false)
  compatibleLens String[]    // single, progressive, bifocal
  // SEO
  metaTitle    String?
  metaDesc     String?
  tags         String[]
  category     String?
  sizeGuide    String?       @db.Text
  draftData    Json?         // autosave wizard state
  publishedAt  DateTime?
  status       ProductStatus @default(DRAFT)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  variants    ProductVariant[]
  media       ProductMedia[]
  reviews     Review[]
  questions   Question[]
  collections CollectionProduct[]
  wishlist    WishlistItem[]
  viewHistory ViewHistory[]

  @@index([slug])
  @@index([status])
  @@index([frameShape])
  @@index([material])
  @@index([brand])
  @@map("products")
}

enum FrameShape {
  SQUARE
  ROUND
  OVAL
  CAT_EYE
  AVIATOR
  RECTANGLE
  GEOMETRIC
  BROWLINE
}

enum Material {
  TITANIUM
  TR90
  ACETATE
  METAL
  MIXED
  WOOD
  PLASTIC
}

enum Gender {
  UNISEX
  MALE
  FEMALE
  KIDS
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

model ProductVariant {
  id             String   @id @default(cuid())
  productId      String
  product        Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  sku            String   @unique
  frameColor     String
  lensColor      String?
  size           String?  // S / M / L or custom
  weight         Int?     // grams — override product
  // Variant-level spec overrides (inherit from product if null)
  lensWidth      Int?     // mm
  bridge         Int?     // mm
  templeLength   Int?     // mm
  lensHeight     Int?     // mm
  frameWidth     Int?     // mm
  material       String?  // override product-level material
  price          Int
  compareAtPrice Int?
  stockQty       Int      @default(0)
  reservedQty    Int      @default(0)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())

  cartItems  CartItem[]
  orderItems OrderItem[]
  media      ProductMedia[]

  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model ProductMedia {
  id        String          @id @default(cuid())
  productId String
  product   Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])
  type      MediaType
  url       String
  alt       String?
  sort      Int             @default(0)

  @@index([productId])
  @@map("product_media")
}

enum MediaType {
  IMAGE
  VIDEO
}

model Collection {
  id          String              @id @default(cuid())
  name        String
  slug        String              @unique
  description String?
  image       String?
  sort        Int                 @default(0)
  isActive    Boolean             @default(true)
  products    CollectionProduct[]

  @@map("collections")
}

model CollectionProduct {
  id           String     @id @default(cuid())
  collectionId String
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  productId    String
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  sort         Int        @default(0)

  @@unique([collectionId, productId])
  @@map("collection_products")
}

// ─── Lens Options (Prescription) ──────────────────────────

model LensOption {
  id       String  @id @default(cuid())
  name     String
  type     String  // "blue_light", "photochromic", "uv", "polarized", "progressive", "bifocal"
  desc     String?
  price    Int
  isActive Boolean @default(true)
  sort     Int     @default(0)

  @@map("lens_options")
}
